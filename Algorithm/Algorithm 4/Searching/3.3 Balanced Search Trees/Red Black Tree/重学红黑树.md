# 红黑树

重学主要是因为学过了 AVL 树，并且对 B 树有所了解，再次学习又有新的感受。

比较重要的性质

- 根节点一定是黑色
- 新增节点是红色
- null 空节点是黑色
- 不能同时存在两个相邻的红色节点

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78762ae27e0b4e2cbaa8a4ce2b17f48a~tplv-k3u1fbpfcp-watermark.image?)

红黑树跟最有拥有三个键值的 B 树（四阶 B 树）具有等价性，黑色节点跟子节点(RED)融合在一起，形成一个 B 树节点。
注意：**具有三个节点的B树节点，等价到红黑树上，就是一个黑色根节点与两个红色子节点**。

这也从另外一个角度解释了为什么红黑树中父子节点不能同时为红色。

## 添加

### 添加的所有情况

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e2b2def3cd94318be94118c003a22e0~tplv-k3u1fbpfcp-watermark.image?)
由于新增节点都是红色节点，如果父节点为黑色，那么红黑平衡，就不需要任何操作。因此，接下来考虑的都是**父节点为红色节点**的情况。
新增节点父节点为红色的情况又分为两种情况来考虑：
1. 叔叔节点不是红色
2. 叔叔节点是红色

### 叔叔节点不是红色

叔叔节点指的是父节点的另外一个兄弟（同级）节点，比如 10 的叔叔节点是 33。

#### LL/RR

这里有点像 AVL 树中的 LL/RR，LL 指的是两个红色节点位于左子节点和左子节点的左子节点。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0decba9258354df9b118949bf5ba1b66~tplv-k3u1fbpfcp-watermark.image?)
（图中 灰色节点别管，只是示意这里可以添加）

这里跟 AVL 真的像，不仅需要旋转（切换颜色）保证平衡，并且需要更换根节点。

#### LR/RL

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7c28e068e53d401aaddc9cd827c06242~tplv-k3u1fbpfcp-watermark.image?)

### 叔叔节点是红色

#### LL/RR

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2ca204bd46346608063270fd94e95e3~tplv-k3u1fbpfcp-watermark.image?)

#### 等价于 B 树的上溢

对于叔叔节点是红色的情况，需要分裂成两个黑色根节点，并且将原来的根节点向上合并。根节点向上合并后需要染成红色（新添加）节点。

**这种情况只需要染色，不需要旋转。**
注意这里有个细节，向上合并的节点会变红，上溢之后会导致新的红黑失衡的情况。（但这种失衡的情况在已经考虑的范围内，类似向上递归调用保持平衡）

#### LR/RL

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cbf41fe3a5b04b7582f1b8b8264548df~tplv-k3u1fbpfcp-watermark.image?)

也是类似，只需要染色，注意，如果上溢到根节点，就直接将根节点染黑即可。



![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90c7ef3d253e4bee93a55d9c2d368a0b~tplv-k3u1fbpfcp-watermark.image?)
比如这种情况，55上溢，38，和55右侧节点变黑，55上溢变红，再将55染黑即可（因为是根节点）。并不破坏性质。


## 删除

### 删除叶子节点

1.删除RED节点
- 删除红色节点并不影响红黑树结构，直接删除即可。

2.删除BLACK节点
- 拥有两个RED节点的黑色节点（不需要考虑，因为会用其中一个红色节点替代）
- 拥有一个RED节点的黑色节点 <- 从这里开始分析
- 黑色叶子节点
 
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8437f187d42946259b71989f7e58a088~tplv-k3u1fbpfcp-watermark.image?)


### 删除拥有一个RED节点的黑色节点

用子节点（RED）替代要删除的黑色节点，并且将 RED 节点染黑即可维持红黑树性质。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3076a3853bb348169280c35ca0c20be0~tplv-k3u1fbpfcp-watermark.image?)
